<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Barbearia Davi Dias</title>
  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-color: #111;
      color: #fff;
    }
    header {
      background-color: #000;
      padding: 2rem;
      text-align: center;
    }
    h1 {
      font-family: 'Anton', sans-serif;
      font-size: 3rem;
      color: #e6b800;
    }
    main {
      max-width: 800px;
      margin: auto;
      padding: 2rem;
    }
    .feedback-form input, .feedback-form textarea, .feedback-form select {
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      border: none;
    }
    .feedback-form button {
      background-color: #e6b800;
      padding: 0.75rem;
      border: none;
      font-weight: bold;
      cursor: pointer;
      border-radius: 8px;
    }
    .feedback-list {
      margin-top: 2rem;
    }
    .feedback-item {
      background-color: #1a1a1a;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
    }
    .stars {
      color: gold;
    }
    #admin-section {
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>Barbearia Davi Dias</h1>
  </header>
  <main>
    <section class="feedback-form">
      <h2>Deixe seu Feedback ‚≠ê</h2>
      <input type="text" id="nome" placeholder="Seu nome"/>
      <textarea id="comentario" placeholder="Coment√°rio..."></textarea>
      <select id="nota">
        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
        <option value="3">‚≠ê‚≠ê‚≠ê</option>
        <option value="2">‚≠ê‚≠ê</option>
        <option value="1">‚≠ê</option>
      </select>
      <button onclick="enviarFeedback()">Enviar</button>
    </section>

    <section class="feedback-list" id="lista-feedbacks">
      <h2>Feedbacks Recebidos üó£Ô∏è</h2>
    </section>

    <section id="admin-section">
      <h2>Painel do Admin</h2>
      <input type="file" id="imgUpload" />
      <button onclick="uploadImagem()">Adicionar Foto √† Galeria</button>
      <div id="galeria"></div>
    </section>
  </main>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL, listAll } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDx2IBIdo7_b0P9tMWhkxAvM0ehBa9cYas",
      authDomain: "testgithub-d13a2.firebaseapp.com",
      projectId: "testgithub-d13a2",
      storageBucket: "testgithub-d13a2.appspot.com",
      messagingSenderId: "847448063225",
      appId: "1:847448063225:web:1f51f702060de265f6898e",
      databaseURL: "https://testgithub-d13a2-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();
    const storage = getStorage();

    const enviarFeedback = () => {
      const nome = document.getElementById('nome').value;
      const comentario = document.getElementById('comentario').value;
      const nota = document.getElementById('nota').value;

      if (nome && comentario) {
        push(ref(db, 'feedbacks'), {
          nome, comentario, nota
        });
        alert("Feedback enviado!");
        document.getElementById('nome').value = "";
        document.getElementById('comentario').value = "";
      }
    };

    const listarFeedbacks = () => {
      const lista = document.getElementById('lista-feedbacks');
      onValue(ref(db, 'feedbacks'), (snapshot) => {
        lista.innerHTML = "<h2>Feedbacks Recebidos üó£Ô∏è</h2>";
        snapshot.forEach(child => {
          const fb = child.val();
          lista.innerHTML += `
            <div class="feedback-item">
              <strong>${fb.nome}</strong> - <span class="stars">${'‚≠ê'.repeat(fb.nota)}</span><br/>
              ${fb.comentario}
            </div>
          `;
        });
      });
    };

    const uploadImagem = () => {
      const file = document.getElementById('imgUpload').files[0];
      if (file) {
        const storageRef = sRef(storage, 'galeria/' + file.name);
        uploadBytes(storageRef, file).then(() => {
          alert("Foto enviada!");
          carregarGaleria();
        });
      }
    };

    const carregarGaleria = () => {
      const container = document.getElementById('galeria');
      container.innerHTML = "<h3>Galeria Atual</h3>";
      const galeriaRef = sRef(storage, 'galeria/');
      listAll(galeriaRef).then(res => {
        res.items.forEach(itemRef => {
          getDownloadURL(itemRef).then(url => {
            container.innerHTML += `<img src="${url}" style="width:150px;margin:10px;border-radius:10px"/>`;
          });
        });
      });
    };

    onAuthStateChanged(auth, user => {
      if (user) {
        document.getElementById('admin-section').style.display = 'block';
        carregarGaleria();
      }
    });

    signInWithEmailAndPassword(auth, "admin@barbearia.com", "123456")
      .catch(() => console.warn("Login falhou"));

    listarFeedbacks();
  </script>
</body>
</html>
