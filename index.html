<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Barbearia Davi Dias</title>
<style>
  body {
    font-family: 'Roboto', sans-serif;
    margin: 0;
    background: #111;
    color: #fff;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
    padding: 1rem;
  }
  header {
    background: #000;
    padding: 1.5rem;
    text-align: center;
    position: relative;
  }
  h1 {
    font-family: 'Anton', sans-serif;
    font-size: 2.8rem;
    color: #e6b800;
    margin: 0;
  }
  .btn-agendar {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: #e6b800;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 6px;
    color: black;
    font-weight: bold;
    text-decoration: none;
  }
  section {
    margin-top: 2rem;
  }
  .feedback-item {
    background: #1c1c1c;
    margin: 1rem 0;
    padding: 1rem;
    border-radius: 8px;
  }
  .stars {
    color: gold;
  }
  .gallery {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  .gallery img {
    width: 150px;
    border-radius: 8px;
  }
  .barbeiros {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 2rem;
  }
  .barbeiro {
    background: #1a1a1a;
    padding: 1rem;
    border-radius: 8px;
    flex: 1;
    min-width: 200px;
    text-align: center;
  }
  .barbeiro img {
    width: 100px;
    border-radius: 50%;
    margin-bottom: 0.5rem;
  }
  .barbeiro h3 {
    margin: 0.5rem 0 0.2rem 0;
    color: gold;
  }
  form {
    margin-top: 1rem;
    background: #222;
    padding: 1rem;
    border-radius: 8px;
  }
  label {
    display: block;
    margin-top: 0.8rem;
  }
  input[type="text"], textarea, select {
    width: 100%;
    padding: 0.5rem;
    margin-top: 0.3rem;
    border-radius: 4px;
    border: none;
    font-size: 1rem;
  }
  button {
    margin-top: 1rem;
    background: #e6b800;
    color: black;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    padding: 0.6rem 1rem;
  }
  #login-link {
    margin-top: 1rem;
    text-align: center;
  }
  #login-link a {
    color: #e6b800;
    text-decoration: none;
    font-weight: bold;
  }
</style>
</head>
<body>
  <header>
    <h1>Barbearia Davi Dias</h1>
    <a class="btn-agendar" href="https://www.instagram.com/barbeiro.davi_dias" target="_blank">üìÖ Agendar Corte</a>
  </header>

  <main>
    <section>
      <h2>Feedbacks Recentes</h2>
      <div id="feedbacks"></div>
    </section>

    <section>
      <h2>Deixe seu Feedback</h2>
      <div id="feedback-form-container"></div>
    </section>

    <section>
      <h2>Galeria</h2>
      <div id="galeria" class="gallery"></div>
    </section>

    <section>
      <h2>Nossa Equipe</h2>
      <div class="barbeiros">
        <div class="barbeiro">
          <img src="https://i.imgur.com/sHcGSLJ.png" alt="Davi Dias" />
          <h3>Davi Dias</h3>
          <p>Especialista em cortes modernos e barba na navalha.</p>
        </div>
        <div class="barbeiro">
          <img src="https://i.imgur.com/4ZPRAZL.png" alt="Lucas Silva" />
          <h3>Lucas Silva</h3>
          <p>Corte na tesoura, social e atendimento kids.</p>
        </div>
        <div class="barbeiro">
          <img src="https://i.imgur.com/76Ardh2.png" alt="Andr√© Costa" />
          <h3>Andr√© Costa</h3>
          <p>Desenhos na m√°quina, freestyle e degrad√™ avan√ßado.</p>
        </div>
      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    import {
      getAuth,
      onAuthStateChanged,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDx2IBIdo7_b0P9tMWhkxAvM0ehBa9cYas",
      authDomain: "testgithub-d13a2.firebaseapp.com",
      databaseURL: "https://testgithub-d13a2-default-rtdb.firebaseio.com",
      projectId: "testgithub-d13a2",
      storageBucket: "testgithub-d13a2.appspot.com",
      messagingSenderId: "847448063225",
      appId: "1:847448063225:web:1f51f702060de265f6898e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();

    const feedbacksDiv = document.getElementById("feedbacks");
    const feedbackFormContainer = document.getElementById("feedback-form-container");
    const galeriaDiv = document.getElementById("galeria");

    // Carregar feedbacks do banco
    function carregarFeedbacks() {
      onValue(ref(db, "feedbacks"), snapshot => {
        feedbacksDiv.innerHTML = "";
        snapshot.forEach(child => {
          const fb = child.val();
          const div = document.createElement("div");
          div.className = "feedback-item";
          div.innerHTML = `<strong>${fb.nome}</strong> - <span class="stars">${'‚≠ê'.repeat(fb.nota)}</span><br/>${fb.comentario}`;
          feedbacksDiv.appendChild(div);
        });
      });
    }

    carregarFeedbacks();

    // Monitorar estado do usu√°rio para mostrar ou esconder formul√°rio
    onAuthStateChanged(auth, user => {
      if (user) {
        mostrarFormularioFeedback(user);
      } else {
        mostrarLoginLink();
      }
    });

    function mostrarLoginLink() {
      feedbackFormContainer.innerHTML = `
        <p>Para deixar seu feedback, por favor <a href="login.html">fa√ßa login</a> ou <a href="cadastro.html">cadastre-se</a>.</p>
      `;
    }

    function mostrarFormularioFeedback(user) {
      feedbackFormContainer.innerHTML = `
        <form id="feedback-form">
          <label for="nome">Nome:</label>
          <input type="text" id="nome" value="${user.displayName || ''}" placeholder="Seu nome" required />

          <label for="nota">Nota (1 a 5):</label>
          <select id="nota" required>
            <option value="">Escolha...</option>
            <option value="1">1 ‚≠ê</option>
            <option value="2">2 ‚≠ê‚≠ê</option>
            <option value="3">3 ‚≠ê‚≠ê‚≠ê</option>
            <option value="4">4 ‚≠ê‚≠ê‚≠ê‚≠ê</option>
            <option value="5">5 ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
          </select>

          <label for="comentario">Coment√°rio:</label>
          <textarea id="comentario" rows="4" placeholder="Deixe seu coment√°rio" required></textarea>

          <button type="submit">Enviar Feedback</button>
        </form>
      `;

      const form = document.getElementById("feedback-form");
      form.addEventListener("submit", e => {
        e.preventDefault();
        enviarFeedback(user);
      });
    }

    function enviarFeedback(user) {
      const nome = document.getElementById("nome").value.trim();
      const nota = Number(document.getElementById("nota").value);
      const comentario = document.getElementById("comentario").value.trim();

      if (!nome || !nota || !comentario) {
        alert("Por favor, preencha todos os campos.");
        return;
      }

      // Gravar no Firebase Database
      push(ref(db, "feedbacks"), {
        nome,
        nota,
        comentario,
        userId: user.uid,
        email: user.email,
        timestamp: Date.now()
      })
        .then(() => {
          alert("Obrigado pelo seu feedback!");
          // Limpar form
          document.getElementById("feedback-form").reset();
        })
        .catch(err => {
          alert("Erro ao enviar feedback: " + err.message);
        });
    }

    // Carregar galeria
    import { getStorage, ref as sRef, listAll, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";
    const storage = getStorage();

    function carregarGaleria() {
      listAll(sRef(storage, "galeria/")).then(res => {
        galeriaDiv.innerHTML = "";
        res.items.forEach(item => {
          getDownloadURL(item).then(url => {
            galeriaDiv.innerHTML += `<img src="${url}" alt="Galeria imagem" />`;
          });
        });
      });
    }

    carregarGaleria();
  </script>
</body>
</html>
